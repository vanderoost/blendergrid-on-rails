<%= form_with model: [upload, project_intake] do |form| %>
  <%= render "shared/form_errors", form: form %>

  <h3><%= "Found #{pluralize(upload.blend_files.count, ".blend file")}" %></h3>
  <% upload.blend_files.each.map(&:blob).map(&:filename).each do |filepath| %>
    <%= form.checkbox :blend_files, { multiple: true, include_hidden: false }, filepath %>
    <%= form.label :blend_files, filepath, value: filepath %>
    <br>
  <% end %>

  <h3><%= "Found #{pluralize(upload.zip_files.count, ".zip file")}" %></h3>
  <% upload.zip_files.each.map(&:blob).each do |blob| %>
    <h4><%= blob.filename %></h4>
    <% blob.metadata[:blend_files]&.each do |filepath| %>
      <%= form.checkbox :blend_files, { multiple: true, include_hidden: false }, filepath %>
      <%= form.label :blend_files, filepath, value: filepath %>
      <br>
    <% end %>
  <% end %>

  <div>
    <%= form.submit "Create Projects" %>
  </div>
<% end %>
