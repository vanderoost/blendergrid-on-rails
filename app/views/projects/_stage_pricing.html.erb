<div class="mt-6">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="mx-auto text-base uppercase text-gray-500 lg:mx-0 dark:text-gray-400">
      Price calculation
    </h2>
  </div>

  <%= form_with model: @order || Order.new,
    data: { turbo: false } do |form| %>

    <div class="bg-white dark:bg-gray-800/50 mt-3 overflow-hidden border border-gray-100 dark:border-white/10 rounded-xl">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="mx-auto lg:mx-0">
          <table class="w-full text-left">
            <thead class="sr-only">
              <tr>
                <th>Project</th>
                <th class="hidden sm:table-cell">Type</th>
                <th>Edit settings</th>
              </tr>
            </thead>
            <tbody>

              <% stage_pricing.projects.each do |project| %>
                <tr class="group/row">
                  <td class="relative py-5 pr-6">
                    <div class="flex gap-x-6">
                      <% if project.in_progress? %>
                        <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="hidden animate-spin h-6 w-5 flex-none text-gray-400 sm:block dark:text-gray-500">
                          <path d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd" fill-rule="evenodd" />
                        </svg>
                      <% end %>
                      <div class="flex-auto">
                        <div class="flex items-start gap-x-3">
                          <div class="text-sm/6 font-medium text-gray-900 dark:text-white">
                            <%= project.name %>
                          </div>
                          <div class="rounded-md bg-amber-50 px-2 py-1 text-xs font-medium text-amber-700 inset-ring inset-ring-amber-600/10 dark:bg-amber-900/30 dark:text-amber-400 dark:inset-ring-amber-500/20">
                            <%= project.status.titleize %>
                          </div>
                        </div>
                        <div class="mt-1 text-xs/5 text-gray-500 dark:text-gray-400">
                          <% if project.in_progress? %>
                            Created <%= time_ago_in_words(project.created_at) %> ago
                          <% else %>
                            <%= number_to_currency(project.price_cents.fdiv(100)) %> USD
                          <% end %>
                        </div>
                      </div>
                    </div>
                    <div class="absolute right-full bottom-0 h-px w-screen bg-gray-100 dark:bg-white/10 group-last/row:hidden"></div>
                    <div class="absolute bottom-0 left-0 h-px w-screen bg-gray-100 dark:bg-white/10 group-last/row:hidden"></div>
                  </td>
                  <td class="hidden py-5 pr-6 sm:table-cell">
                    <div class="text-sm/6 text-gray-900 dark:text-white">

                      <%= form.fields_for :project_settings, project.settings, index: project.uuid do |fields| %>
                        <%= fields.number_field :cycles_samples, value: project.settings.spp %>
                      <% end %>

                    </div>
                    <div class="mt-1 text-xs/5 text-gray-500 dark:text-gray-400"><%= frame_description project %></div>
                  </td>
                  <td class="py-5 text-right">
                    <div class="flex justify-end">
                      <a href="#" class="text-sm/6 font-medium text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300">
                        Edit<span class="hidden sm:inline"> settings</span>
                      </a>
                    </div>
                    <div class="mt-1 text-xs/5 text-gray-500 dark:text-gray-400">Found warnings</div>
                  </td>
                </tr>
              <% end %>

            </tbody>
          </table>
        </div>
      </div>
    </div>

    <%= render "shared/form_errors", form: form %>

    <% unless stage_pricing.projects.all?(&:in_progress?) %>
      <div class="mx-auto max-w-7xl flex justify-end">
        <%= form.submit "Start Rendering", class: "text-sm lg:text-base mt-4 rounded-xl bg-primary-600 px-4 sm:px-6 lg:px-8 py-2 lg:py-3 font-semibold text-white shadow-xs hover:bg-primary-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 dark:bg-primary-500 dark:shadow-none dark:hover:bg-primary-400 dark:focus-visible:outline-primary-500" %>
      </div>
    <% end %>
  <% end %>
</div>
